"use client";

import { useEffect, useRef, useState } from "react";
import HanziWriter from "hanzi-writer";

// Character order for animation: 遇→見→東→方
const CHARACTERS = ["遇", "見", "東", "方"];
const STROKE_COLOR = "#C52F2F";
const ANIMATION_SPEED = 1.5;

export default function HanziSeal() {
  const containerRef = useRef<HTMLDivElement>(null);
  const writersRef = useRef<HanziWriter[]>([]);
  const [isVisible, setIsVisible] = useState(false);

  useEffect(() => {
    if (!containerRef.current) return;

    // Clear any existing content
    const charContainers = containerRef.current.querySelectorAll(".hanzi-char");
    charContainers.forEach((el) => (el.innerHTML = ""));
    writersRef.current = [];

    // Create a writer for each character - larger size
    CHARACTERS.forEach((char, index) => {
      const charDiv = document.getElementById(`hanzi-${index}`);
      if (!charDiv) return;

      const writer = HanziWriter.create(`hanzi-${index}`, char, {
        width: 130,
        height: 130,
        padding: 3,
        strokeColor: STROKE_COLOR,
        radicalColor: STROKE_COLOR,
        strokeAnimationSpeed: ANIMATION_SPEED,
        delayBetweenStrokes: 100,
        showOutline: false,
        showCharacter: false,
      });

      writersRef.current.push(writer);
    });

    // Start animation after a delay
    const timer = setTimeout(() => {
      setIsVisible(true);
      animateSequentially(0);
    }, 800);

    return () => {
      clearTimeout(timer);
      writersRef.current = [];
    };
  }, []);

  const animateSequentially = (index: number) => {
    if (index >= writersRef.current.length) return;

    const writer = writersRef.current[index];
    writer.animateCharacter({
      onComplete: () => {
        setTimeout(() => animateSequentially(index + 1), 120);
      },
    });
  };

  return (
    <div
      className={`transition-opacity duration-500 ${isVisible ? "opacity-100" : "opacity-0"}`}
    >
      {/* Dramatic organic seal border - larger and more spread out */}
      <div className="relative" ref={containerRef}>
        <svg
          viewBox="0 0 380 520"
          className="w-full h-auto"
          style={{ minWidth: "340px", maxWidth: "420px" }}
        >
          {/* Outer border - dramatic organic curves with breakpoints */}
          <path
            d="M18 25 
               C35 8, 80 18, 130 12 
               Q165 8, 190 14 
               C220 6, 280 16, 320 10 
               Q345 8, 362 22
               C378 38, 375 70, 372 120 
               Q376 165, 370 210 
               C378 260, 374 310, 376 360 
               Q378 410, 368 450 
               C358 485, 340 502, 300 508 
               Q250 515, 190 512 
               C130 518, 80 510, 45 502 
               Q18 495, 10 460 
               C2 420, 6 370, 4 320 
               Q0 270, 8 220 
               C2 170, 6 120, 4 75 
               Q2 45, 18 25 Z"
            fill="none"
            stroke={STROKE_COLOR}
            strokeWidth="4"
            strokeLinecap="round"
            strokeLinejoin="round"
            className="transition-all duration-300"
          />
          
          {/* Inner border - organic with subtle variations */}
          <path
            d="M38 50 
               C52 35, 95 42, 140 38 
               Q175 34, 190 40 
               C225 32, 275 42, 315 36 
               Q338 34, 348 48
               C360 62, 356 92, 354 135 
               Q358 175, 352 220 
               C360 265, 356 310, 358 355 
               Q360 400, 352 435 
               C344 465, 328 478, 292 483 
               Q245 489, 190 486 
               C135 491, 88 484, 58 478 
               Q35 472, 28 440 
               C20 405, 24 360, 22 315 
               Q18 270, 26 225 
               C20 180, 24 135, 22 95 
               Q20 68, 38 50 Z"
            fill="none"
            stroke={STROKE_COLOR}
            strokeWidth="2"
            opacity="0.6"
            strokeLinecap="round"
            className="transition-all duration-300"
          />

          {/* Small decorative notches/breakpoints on outer border */}
          <circle cx="100" cy="12" r="2" fill={STROKE_COLOR} opacity="0.5" />
          <circle cx="280" cy="10" r="2.5" fill={STROKE_COLOR} opacity="0.4" />
          <circle cx="374" cy="180" r="2" fill={STROKE_COLOR} opacity="0.5" />
          <circle cx="6" cy="280" r="2.5" fill={STROKE_COLOR} opacity="0.4" />
          <circle cx="120" cy="510" r="2" fill={STROKE_COLOR} opacity="0.5" />
          <circle cx="260" cy="512" r="2" fill={STROKE_COLOR} opacity="0.4" />

          {/* Decorative Cloud 1 - Top right area - LARGE flowing cloud */}
          <g transform="translate(220, 20) scale(0.7)" opacity="0.35">
            <path fill={STROKE_COLOR} d="m 64.378981,156.50531 c 0,-1.73314 4.49731,-9.3155 7.84507,-13.22661 3.81129,-4.45264 9.77855,-7.86789 13.74706,-7.86789 6.50676,0 12.26681,-6.81278 10.92505,-12.92177 -1.20702,-5.49553 -8.98699,-9.20843 -12.31718,-5.87823 -1.92127,1.92127 -1.3861,2.96996 0.89314,1.75015 4.89367,-2.61901 10.67245,2.28763 9.41846,7.99702 -1.95591,8.90521 -17.5529,9.675 -21.99468,1.08556 -3.08563,-5.96695 -0.51809,-14.74896 5.64875,-19.32101 4.79782,-3.55706 17.60612,-1.94318 22.948449,2.89156 1.19009,1.07701 1.89198,1.19587 2.3818,0.40332 0.83547,-1.35182 5.98007,-0.39605 9.1903,1.70737 3.02931,1.98488 6.31378,9.11203 6.31378,13.70062 0,4.62866 -2.54951,10.27395 -5.30618,11.74927 -1.12501,0.60209 -7.25385,1.67282 -13.61965,2.37941 -6.365789,0.7066 -13.824169,2.04951 -16.574169,2.98425 -5.7332,1.94876 -13.51065,7.31359 -15.90898,10.97391 -1.61892,2.47078 -3.59102,3.34566 -3.59102,1.59307 z"/>
            <path fill={STROKE_COLOR} d="m 84.720701,141.22367 c 3.38705,-1.05617 10.61981,-2.19363 16.072789,-2.52767 8.92094,-0.54649 10.21816,-0.87867 12.9446,-3.31475 2.66607,-2.38214 3.03675,-3.37481 3.08549,-8.26293 0.0597,-5.98587 -1.77564,-9.55784 -6.47803,-12.60773 l -2.46657,-1.59978 1.85241,2.87111 c 2.43374,3.77215 2.52904,8.99741 0.21082,11.55902 -2.38065,2.63059 -3.17289,2.01678 -3.84273,-2.97726 -1.26823,-9.45536 -9.374769,-15.95287 -19.903409,-15.95287 -4.32808,0 -5.46268,0.44633 -8.2617,3.25 -7.91045,7.92361 -3.98385,19.75 6.5574,19.75 4.04826,0 6.78234,-1.59399 7.93522,-4.62628 1.68691,-4.43692 -2.14002,-8.46522 -6.05273,-6.3712 -1.02291,0.54745 -2.17233,1.97996 -2.55428,3.18336 -0.6799,2.14219 -0.72413,2.14745 -2.11232,0.25106 -3.12166,-4.26447 0.90613,-10.43694 6.81053,-10.43694 5.85349,0 9.97639,4.14771 10.60277,10.66658 0.70119,7.2974 -2.55798,10.73968 -12.74198,13.45786 -5.32579,1.42149 -8.44216,2.91005 -10.75,5.13485 -4.11962,3.97137 -4.21379,5.56317 -0.15828,2.67539 1.70045,-1.21082 5.86295,-3.06564 9.25,-4.12182 z"/>
          </g>

          {/* Decorative Cloud 2 - Middle left (between 遇 and 見) - LARGE */}
          <g transform="translate(20, 170) scale(0.8)" opacity="0.3">
            <path fill={STROKE_COLOR} d="m 60.384011,414.52889 c 0.003,-0.33995 1.70115,-2.85748 3.77416,-5.59453 4.55198,-6.01007 9.50235,-9.52355 13.41835,-9.52355 9.50948,0 15.55979,-9.67057 10.61574,-16.96777 -4.38134,-6.46666 -12.5635,-6.1479 -14.24582,0.55499 -0.81697,3.25507 0.91644,5.61422 1.88435,2.56459 1.36097,-4.28801 8.08315,-3.85285 9.19963,0.59554 2.4927,9.93172 -14.17886,12.41462 -18.23152,2.71523 -2.26939,-5.43141 0.0807,-12.37282 5.27612,-15.58375 2.74806,-1.69839 4.43789,-2.02312 8.20576,-1.57687 9.77759,1.15801 16.1114,6.89776 17.64798,15.99272 l 0.69606,4.11994 1.877079,-2.3181 c 2.49375,-3.07965 2.36743,-5.09485 -0.592789,-9.45697 -2.59134,-3.81856 -2.28596,-4.25762 1.863889,-2.67985 3.00041,1.14076 6.60598,7.70819 6.60598,12.03258 0,4.19891 -2.40559,9.61923 -4.8496,10.92723 -1.11041,0.59427 -4.185999,1.09619 -6.834659,1.11538 -6.92137,0.0501 -19.32197,2.43193 -24.43329,4.69291 -2.41433,1.06797 -6.07556,3.53175 -8.13607,5.47506 -2.06051,1.94331 -3.74412,3.25516 -3.74135,2.91522 z" transform="translate(-50, -375)"/>
          </g>

          {/* Decorative Cloud 3 - Bottom left - LARGE spiral cloud */}
          <g transform="translate(30, 420) scale(0.75)" opacity="0.35">
            <path fill={STROKE_COLOR} d="m 64.378981,156.50531 c 0,-1.73314 4.49731,-9.3155 7.84507,-13.22661 3.81129,-4.45264 9.77855,-7.86789 13.74706,-7.86789 6.50676,0 12.26681,-6.81278 10.92505,-12.92177 -1.20702,-5.49553 -8.98699,-9.20843 -12.31718,-5.87823 -1.92127,1.92127 -1.3861,2.96996 0.89314,1.75015 4.89367,-2.61901 10.67245,2.28763 9.41846,7.99702 -1.95591,8.90521 -17.5529,9.675 -21.99468,1.08556 -3.08563,-5.96695 -0.51809,-14.74896 5.64875,-19.32101 4.79782,-3.55706 17.60612,-1.94318 22.948449,2.89156 1.19009,1.07701 1.89198,1.19587 2.3818,0.40332 0.83547,-1.35182 5.98007,-0.39605 9.1903,1.70737 3.02931,1.98488 6.31378,9.11203 6.31378,13.70062 0,4.62866 -2.54951,10.27395 -5.30618,11.74927 -1.12501,0.60209 -7.25385,1.67282 -13.61965,2.37941 -6.365789,0.7066 -13.824169,2.04951 -16.574169,2.98425 -5.7332,1.94876 -13.51065,7.31359 -15.90898,10.97391 -1.61892,2.47078 -3.59102,3.34566 -3.59102,1.59307 z" transform="translate(-30, -100)"/>
          </g>

          {/* Decorative Cloud 4 - Right side middle (between 東 and 方) - LARGE */}
          <g transform="translate(280, 290) scale(0.65)" opacity="0.3">
            <path fill={STROKE_COLOR} d="m 84.720701,141.22367 c 3.38705,-1.05617 10.61981,-2.19363 16.072789,-2.52767 8.92094,-0.54649 10.21816,-0.87867 12.9446,-3.31475 2.66607,-2.38214 3.03675,-3.37481 3.08549,-8.26293 0.0597,-5.98587 -1.77564,-9.55784 -6.47803,-12.60773 l -2.46657,-1.59978 1.85241,2.87111 c 2.43374,3.77215 2.52904,8.99741 0.21082,11.55902 -2.38065,2.63059 -3.17289,2.01678 -3.84273,-2.97726 -1.26823,-9.45536 -9.374769,-15.95287 -19.903409,-15.95287 -4.32808,0 -5.46268,0.44633 -8.2617,3.25 -7.91045,7.92361 -3.98385,19.75 6.5574,19.75 4.04826,0 6.78234,-1.59399 7.93522,-4.62628 1.68691,-4.43692 -2.14002,-8.46522 -6.05273,-6.3712 -1.02291,0.54745 -2.17233,1.97996 -2.55428,3.18336 -0.6799,2.14219 -0.72413,2.14745 -2.11232,0.25106 -3.12166,-4.26447 0.90613,-10.43694 6.81053,-10.43694 5.85349,0 9.97639,4.14771 10.60277,10.66658 0.70119,7.2974 -2.55798,10.73968 -12.74198,13.45786 -5.32579,1.42149 -8.44216,2.91005 -10.75,5.13485 -4.11962,3.97137 -4.21379,5.56317 -0.15828,2.67539 1.70045,-1.21082 5.86295,-3.06564 9.25,-4.12182 z" transform="translate(-60, -100)"/>
          </g>

          {/* Decorative Cloud 5 - Bottom center - LARGE flowing cloud */}
          <g transform="translate(140, 460) scale(0.85)" opacity="0.32">
            <path fill={STROKE_COLOR} d="m 194.97564,213.272 c -10.54343,-1.3529 -25.73141,-4.62095 -34.8701,-7.50311 -11.23156,-3.5422 -19.58809,-7.92767 -30.17649,-15.83645 -13.10216,-9.7864 -15.48104,-10.81809 -26.09516,-11.31706 -10.450729,-0.49129 -17.311499,0.95526 -30.438019,6.41765 -13.99877,5.82537 -16.26682,6.55492 -22.0698,7.09909 -6.764,0.63429 -18.43524,-2.12399 -28.19709,-6.66385 -6.86313,-3.19177 -9.14269,-5.84423 -4,-4.65433 1.5125,0.34996 8.41697,0.91422 15.34326,1.25392 17.62544,0.86443 24.77262,-1.09285 38.90674,-10.65473 15.40889,-10.42429 29.943039,-13.45447 43.819179,-9.13573 6.93047,2.15701 9.80124,4.03023 20.40743,13.31618 13.72805,12.01922 24.91264,16.12765 43.8201,16.09642 13.25755,-0.0219 20.80993,-1.75939 28.2607,-6.50159 4.43994,-2.82589 5.09853,-2.97255 8.61602,-1.91869 9.41317,2.82026 16.78177,0.20823 20.11275,-7.12957 4.9298,-10.85987 -0.40534,-22.72934 -10.21649,-22.72934 -4.25332,0 -8.81969,3.43207 -8.81969,6.62886 0,1.49543 0.30191,1.43613 2.31445,-0.45455 2.77405,-2.60608 6.83627,-2.78907 10.73887,-0.48374 5.82624,3.44164 6.31284,11.62968 1.04172,17.52909 -2.42672,2.71597 -3.57999,3.17974 -8.69639,3.49714 -11.28162,0.69986 -18.36642,-6.50945 -18.57763,-18.90414 -0.13332,-7.82373 2.23433,-12.93094 8.58696,-18.52275 7.34447,-6.46486 18.28678,-8.87984 26.59202,-5.86887 3.45078,1.25104 3.55277,1.2091 7.25278,-2.98269 14.2465,-16.14003 38.95224,-13.97031 46.41644,4.07642 1.5429,3.7304 2.40185,4.52519 5.97013,5.52425 13.77665,3.85722 16.94431,23.65988 4.7131,29.46397 -4.22817,2.0064 -9.57241,1.49399 -12.62258,-1.21025 -1.52318,-1.35043 -2.13332,-1.47422 -2.47298,-0.50173 -1.06249,3.04211 -6.721,12.90784 -9.54888,16.64871 -6.59549,8.72484 -18.77256,16.79046 -32.2573,21.366 -13.21107,4.48268 -36.72512,6.2534 -53.85405,4.05547 z" transform="translate(-60, -150) scale(0.45)"/></g>

          {/* Staggered zigzag layout - more spread out */}
          {/* 遇 at (0, 3) - left, TOP */}
          {/* 東 at (1.5, 2) - right, second from top */}
          {/* 見 at (0, 1) - left, third from top */}
          {/* 方 at (1.5, 0) - right, BOTTOM */}
          
          {/* 遇 - TOP LEFT (0, 3) */}
          <foreignObject x="35" y="45" width="140" height="140">
            <div
              id="hanzi-0"
              className="hanzi-char flex justify-center items-center w-full h-full"
            />
          </foreignObject>

          {/* 見 - THIRD from top, LEFT (0, 1) */}
          <foreignObject x="35" y="290" width="140" height="140">
            <div
              id="hanzi-1"
              className="hanzi-char flex justify-center items-center w-full h-full"
            />
          </foreignObject>

          {/* 東 - SECOND from top, RIGHT (1.5, 2) */}
          <foreignObject x="200" y="155" width="140" height="140">
            <div
              id="hanzi-2"
              className="hanzi-char flex justify-center items-center w-full h-full"
            />
          </foreignObject>

          {/* 方 - BOTTOM RIGHT (1.5, 0) */}
          <foreignObject x="200" y="355" width="140" height="140">
            <div
              id="hanzi-3"
              className="hanzi-char flex justify-center items-center w-full h-full"
            />
          </foreignObject>
        </svg>
      </div>
    </div>
  );
}
